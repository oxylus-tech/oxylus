import{t as m,rules as R,query as q,createPinia as D,init as K}from"ox";import{OxModelEdit as W,OxAction as H,OxModelPanel as B,App as J}from"ox/components";import{u as G,O as Q,a as X,_ as Y}from"./OxUserEdit.vue_vue_type_script_setup_true_lang.js";import{_ as Z}from"./OxUserPanel.vue_vue_type_script_setup_true_lang.js";import{defineComponent as y,inject as w,createBlock as b,openBlock as v,unref as e,mergeProps as O,withCtx as u,createVNode as p,createCommentVNode as j,computed as I,createElementVNode as r,toDisplayString as h,createElementBlock as $,Fragment as ee,renderList as E,useSlots as k,createSlots as F,renderSlot as P,normalizeProps as T,guardReactiveProps as C,mergeModels as te,useAttrs as N,useModel as le,ref as U,onMounted as ne,watch as A}from"vue";import{V as ae,a as M,b as se,c as oe,d as ue,e as re,f as ie,g as de,h as pe}from"./vuetify.js";const z=y({__name:"OxGroupEdit",props:{repo:{},initial:{},name:{},url:{},saved:{type:Function}},setup(c){const f=G(),i=w("user"),o=c;return(l,d)=>(v(),b(e(W),O(o,{repo:e(f).groups}),{default:u(({editor:t,editable:n})=>[p(ae,{mandatory:"",multiple:"","model-value":["info"]},{default:u(()=>[p(M,{title:e(m)("views.edit.informations"),value:"info"},{text:u(()=>{var a;return[p(se,{variant:"underlined",label:"Group name",modelValue:t.value.name,"onUpdate:modelValue":g=>t.value.name=g,rules:[e(R).errors((a=t.errors)==null?void 0:a.name)]},null,8,["modelValue","onUpdate:modelValue","rules"])]}),_:2},1032,["title"]),n&&t.value.id&&e(i).can("auth.view_permission")?(v(),b(M,{key:0,title:e(m)("models.permissions",2),value:"permissions"},{text:u(()=>[p(oe,null,{default:u(()=>[p(Q,{group:t.value,modelValue:t.value.permissions_id,"onUpdate:modelValue":a=>t.value.permissions_id=a},null,8,["group","modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1032,["title"])):j("",!0)]),_:2},1024)]),_:1},16,["repo"]))}}),me={__name:"OxGroupUsers",props:{group:Object},setup(c){const f=w("repos"),i=c,o=I(()=>f.users.where("groups_id",l=>{var d;return l==null?void 0:l.includes((d=i.group)==null?void 0:d.id)}).get());return(l,d)=>(v(),b(ue,null,{default:u(()=>[r("thead",null,[r("tr",null,[r("th",null,h(e(m)("fields.username")),1),r("th",null,h(e(m)("fields.first_name")),1),r("th",null,h(e(m)("fields.last_name")),1),r("th",null,h(e(m)("fields.actions")),1)])]),r("tbody",null,[(v(!0),$(ee,null,E(o.value,t=>(v(),$("tr",null,[r("td",null,h(t.username),1),r("td",null,h(t.first_name),1),r("td",null,h(t.last_name),1),r("td",null,[p(e(H),{button:"",name:"edit",value:t},null,8,["value"])])]))),256))])]),_:1}))}},ce=y({__name:"OxGroupPanel",props:{repo:{},view:{},headers:{default:["id","name"]},relations:{},showFilters:{type:Boolean},fetchRelations:{type:Boolean},search:{},warning:{},name:{default:"groups"},index:{},value:{},state:{},help:{},title:{},icon:{}},setup(c){const f=k(),i=G(),o=c;return(l,d)=>(v(),b(e(B),O(o,{repo:e(i).groups,icon:"mdi-account-multiple"}),F({"views.detail.edit.default":u(({value:t,saved:n})=>[p(z,{initial:t,saved:n},null,8,["initial","saved"])]),_:2},[E(e(f),(t,n)=>({name:n,fn:u(a=>[P(l.$slots,n,T(C(a)))])}))]),1040,["repo"]))}}),L=y({__name:"OxAgentSelect",props:te({user:{type:Object,default:null},menu:Boolean,icon:{type:String,default:"mdi-account-key"}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(c,{expose:f}){const i=N(),o=c,l=le(c,"modelValue"),d=X(),t=U([]),n=U(null);var a=null;const g=w("user");async function x(s){if(s&&s!=a){a=s;const V=await q(d.agents).fetch({path:"/user",params:{user:s},dataKey:null});t.value=V.response.data,n.value=l.value?t.value.find(_=>_.id==l.value):t.value.find(_=>_.user==s),l.value!=n.value.id&&(l.value=n.value.id)}}return ne(()=>{var s;return x(((s=o.user)==null?void 0:s.id)||g.id)}),A(()=>o.user,s=>x((s==null?void 0:s.id)||g.id)),A(l,s=>{n.value=t.value.find(V=>V.id==s)}),f({value:l,item:n,items:t}),(s,V)=>o.menu?(v(),b(re,O({key:0,"aria-label":e(m)("fields.agent.select"),title:e(m)("fields.agent.select")},e(i)),{activator:u(({props:_})=>{var S;return[p(de,O(_,{"prepend-icon":o.icon,text:(S=n.value)==null?void 0:S.name}),null,16,["prepend-icon","text"])]}),default:u(()=>[p(ie,{items:t.value,"item-title":"name","item-value":"id",selectable:"",selected:l.value,"onUpdate:selected":V[0]||(V[0]=_=>l.value=_)},null,8,["items","selected"])]),_:1},16,["aria-label","title"])):(v(),b(pe,O({key:1,items:t.value,"item-title":"name","item-value":"id","prepend-icon":o.icon,"aria-label":e(m)("fields.agent.select"),title:e(m)("fields.agent.select"),modelValue:l.value,"onUpdate:modelValue":V[1]||(V[1]=_=>l.value=_)},e(i)),null,16,["items","prepend-icon","aria-label","title","modelValue"]))}}),fe=y({__name:"OxOwnedPanel",setup(c){const f=k(),i=N(),o=w("user"),l=U(null);return(d,t)=>(v(),b(e(B),T(C(e(i))),F({"app-bar-right":u(({panel:n,list:a,...g})=>{var x;return[p(e(L),{ref_key:"agent",ref:l,modelValue:a.filters.owner__uuid,"onUpdate:modelValue":s=>a.filters.owner__uuid=s,user:e(o),menu:"",disabled:n.view.startsWith("detail")},null,8,["modelValue","onUpdate:modelValue","user","disabled"]),P(d.$slots,"app-bar-right",O({panel:n,list:a,owner:(x=l.value)==null?void 0:x.item},g))]}),_:2},[E(e(f),(n,a)=>({name:a,fn:u(g=>{var x;return[a!="app-bar-right"?P(d.$slots,a,O({key:0},g,{owner:(x=l.value)==null?void 0:x.item})):j("",!0)]})}))]),1040))}}),_e=Object.freeze(Object.defineProperty({__proto__:null,OxAgentSelect:L,OxGroupEdit:z,OxGroupPanel:ce,OxGroupUsers:me,OxOwnedPanel:fe,OxUserEdit:Y,OxUserPanel:Z},Symbol.toStringTag,{value:"Module"})),ve={extends:J,components:_e},ge=D();K({App:ve,plugins:[ge]});
//# sourceMappingURL=index.js.map
